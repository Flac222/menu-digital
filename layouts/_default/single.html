{{/* Definir el menú al inicio para usarlo en todo el template */}}
{{ $menu := index site.Data.restaurantes .Params.menuId }}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{{ .Title }} | {{ $menu.restaurantInfo.nombre }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    {{/* Descripción: usar la del JSON; si no hay, fallback a .Title */}}
    <meta name="description" content="{{ with $menu.restaurantInfo.descripcion }}{{ . }}{{ else }}{{ .Title }}{{ end }}">

    {{/* SEO básico */}}
    <meta name="keywords" content="restaurante, comida, delivery, Villa Gesell, Argentina, menú, pizzas, empanadas">
    <meta name="author" content="{{ $menu.restaurantInfo.nombre }}">

    {{/* Open Graph / Social */}}
    <meta property="og:title" content="{{ $menu.restaurantInfo.nombre }}">
    <meta property="og:description" content="{{ with $menu.restaurantInfo.descripcion }}{{ . }}{{ else }}{{ .Title }}{{ end }}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ .Permalink }}">
    {{ with $menu.restaurantInfo.logo }}<meta property="og:image" content="{{ . }}">{{ end }}

    {{/* Favicon: si hay logo, usarlo; si no, nada */}}
    {{ with $menu.restaurantInfo.logo }}<link rel="icon" href="{{ . }}" type="image/png">{{ end }}

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    {{/* Estilos básicos con colores del front matter */}}
    <style>
        :root{
            --color-primario: {{ .Params.color_primario }};
            --color-secundario: {{ .Params.color_secundario }};
            --color-terciario: {{ .Params.color_terciario }};
        }

        /* --- ARREGLO 1: FOOTER PEGADO ABAJO (Sticky Footer) --- */
        html {
            height: 100%; /* El html debe ocupar todo el alto de la ventana */
        }
        body {
            margin: 0;
            padding: 0;
            font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
            color: var(--color-terciario);
            background: var(--color-secundario);
            line-height: 1.5;
            display: flex; /* Habilitar flexbox en el body */
            flex-direction: column; /* Apilar elementos verticalmente */
            min-height: 100%; /* El body debe ocupar al menos el 100% del viewport */
            min-height: 100dvh;
            overflow-x: hidden; /* Evita scroll horizontal */
            overscroll-behavior: none; /* Evita rebote blanco en mobile */
            user-select: none; /* Evita selección de texto */
            -webkit-user-select: none; /* Soporte para Safari */
            -moz-user-select: none; /* Soporte para Mozzilla */
            cursor: default; /* Cursor normal, no de texto */
        }
        main {
            flex-grow: 1; /* Esto hace que el main (el contenido) ocupe todo el espacio sobrante, empujando el footer hacia abajo */
        }
        /* --- FIN ARREGLO 1 --- */

        *{box-sizing:border-box}
        
        header{
            background:var(--color-primario);
            color:#fff;
            padding:1.5rem;
            text-align:center;
        }
        header .brand{
            max-width:960px;
            margin:0 auto;
            display:flex;
            align-items:center;
            gap:1rem;
            justify-content:center;
            flex-wrap:wrap;
        }
        header img.logo{
            max-height:80px;
            border-radius:8px;
        }
        .container{
            max-width:960px;
            margin:0 auto;
            padding:1rem;
        }
        .info{
            text-align:center;
            margin:1rem auto 2rem;
        }
        .info p{margin:.25rem 0}

        /* MODIFICACIÓN: Estilo para los íconos de redes sociales */
        .info .social-links a{
            color:var(--color-primario);
            text-decoration:none;
            font-size: 1.8rem; /* Tamaño de los íconos */
            padding: 0 0.75rem; /* Espaciado entre íconos */
        }
        .info a:hover{
            text-decoration:none; /* Quitar subrayado en el hover */
            opacity: 0.8;
        }
        /* FIN MODIFICACIÓN */

        .category{
            margin:2rem 0;
            background:#fff;
            border:1px solid #eee;
            border-radius:12px;
            overflow:hidden;
            box-shadow:0 2px 8px rgba(0,0,0,.06);
        }

        .category-header {
            padding: .75rem 1rem;
            background: rgba(30,47,111,.08);
            border-left: 6px solid var(--color-primario);
            display: flex; /* Flex por defecto */
            align-items: center;
            justify-content: space-between;
        }

        .category-header h2 {
            margin: 0;
            font-size: 1.25rem;
            color: var(--color-terciario);
            /* ARREGLO 2: Permite que el título ocupe 1 columna en el grid */
            align-self: flex-start; 
        }

        .header-variant-label {
            font-weight: 700;
            color: var(--color-primario);
            text-align: right;
            font-size: 0.9rem;
            padding-left: 10px;
            display: flex;
            align-items: center;
            /* ARREGLO 2: Centrar el texto en su celda para alineación */
            justify-content: center; 
        }

        .products{
            list-style:none;
            margin:0;
            padding:0;
        }

        /* ARREGLO 2: Alineación de variantes (Grid) */
        .product{
            padding:.75rem 1rem;
            border-top:1px solid #f1f1f1;
            align-items: stretch; /* Asegura que todos los elementos de la fila se estiren (si es necesario) */
        }
        .product:first-child{border-top:none}
        .product .name{font-weight:600}
        .product .price{
            font-weight:700;
            color:var(--color-primario);
        }
        /* Precio simple */
        .product.single-price { 
            display:flex; 
            justify-content:space-between; 
            align-items:center; 
        }
        .product.single-price .price { 
            font-weight:700; 
            color:var(--color-primario); 
        }

        .grid-layout {
            display: grid;
            align-items: center;
        }

        .variant-price {
            /* ARREGLO 2: Centrar el precio en su celda para alineación */
            text-align: center;
            color: var(--color-primario);
            font-weight: 700;
            padding-left: 10px;
        }

        .product .text {
            /* ARREGLO 2: Asegura que el texto ocupe toda la primera columna del grid */
            align-self: start; 
            padding-right: 10px; /* Espacio antes de los precios */
        }
        .product .desc {
            margin: 0.25rem 0 0;
            font-size: 0.85rem;
            color: #666;
        }
        /* --- FIN ARREGLO 2 --- */
        /* --- NUEVOS ESTILOS PARA PLEGABLES (COLLAPSIBLE) --- */

        /* 1. Eliminar el marcador nativo del navegador */
        details > summary {
            list-style: none; /* Chrome, Edge, Safari */
            cursor: pointer;
        }
        details > summary::marker, /* Firefox */
        details > summary::-webkit-details-marker /* Chrome, Safari */
        {
            display: none;
        }

        /* 2. Añadir el icono de expansión con Font Awesome */
        .category-header {
            /* ... Tus estilos existentes ... */
            position: relative; /* Para posicionar el icono */
            padding-right: 2.5rem; /* Deja espacio para el icono */
        }

        /* Icono (flecha) */
        .category-header::after {
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            content: "\f0d7"; /* Código de Font Awesome para "caret-down" (flecha abajo) */
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-primario);
            transition: transform 0.2s ease-in-out;
            font-size: 1.25rem;
        }

        /* Rotar el icono cuando está ABIERTO */
        .category[open] > .category-header::after {
            transform: translateY(-50%) rotate(180deg); /* Gira la flecha hacia arriba */
        }
        .category:not([open]) .header-variant-label {
          display: none;
        }

        /* 3. Estilizar el contenido (opcional) */
        .category-content {
            /* Esto es solo para mantener la estructura limpia,
              ya que .products ya está estilizado */
            padding-bottom: 0.5rem; 
        }
        /* --- FIN NUEVOS ESTILOS --- */

        footer{
            margin-top:3rem;
            padding:1rem;
            text-align:center;
            background:var(--color-primario);
            color:#fff;
            /* El flex-grow: 1 en main es lo que realmente lo empuja */
        }
    </style>
</head>

<body>
    <header>
        <div class="brand">
            {{ with $menu.restaurantInfo.logo }}<img class="logo" src="{{ . }}" alt="Logo {{ $menu.restaurantInfo.nombre }}">{{ end }}
            <div>
                <h1 style="margin:.25rem 0">{{ $menu.restaurantInfo.nombre }}</h1>
                {{ with $menu.restaurantInfo.descripcion }}<p style="margin:.25rem 0">{{ . }}</p>{{ end }}
            </div>
        </div>
    </header>

    <div class="container">
        <section class="info">
            {{ with $menu.restaurantInfo.direccion }}<p><strong>Dirección:</strong> {{ . }}</p>{{ end }}
            {{ with $menu.restaurantInfo.telefono }}<p><strong>Teléfono:</strong> {{ . }}</p>{{ end }}
            {{ with $menu.restaurantInfo.horarios }}<p><strong>Horarios:</strong> {{ . }}</p>{{ end }}
            <p class="social-links">
                {{ with $menu.restaurantInfo.instagram }}
                <a href="{{ . }}" target="_blank" rel="noopener" aria-label="Instagram">
                    <i class="fab fa-instagram"></i>
                </a>
                {{ end }}
                {{ with $menu.restaurantInfo.facebook }}
                <a href="{{ . }}" target="_blank" rel="noopener" aria-label="Facebook">
                    <i class="fab fa-facebook-f"></i>
                </a>
                {{ end }}
                {{ with $menu.restaurantInfo.maps }}
                <a href="{{ . }}" target="_blank" rel="noopener" aria-label="Cómo llegar (Maps)">
                    <i class="fas fa-map-marker-alt"></i>
                </a>
                {{ end }}
            </p>
        </section>

        <main>
            {{ range sort $menu.categories "orden" }}
            <details class="category">
                
                {{/* CORRECCIÓN AQUÍ: Inicializamos variables vacías primero */}}
                {{ $variantes := .variantes }}
                {{ $gridStyle := "" }}
                
                {{/* Solo calculamos el largo y el estilo SI variantes no es null */}}
                {{ if $variantes }}
                    {{ $colCount := len $variantes }}
                    {{ $gridStyle = printf "grid-template-columns: 1fr repeat(%d, auto);" $colCount }}
                {{ end }}

                {{/* --- HEADER DE LA CATEGORÍA --- */}}
                <summary class="category-header {{ if $variantes }}grid-layout{{ end }}" style="{{ $gridStyle | safeCSS }}">
                    <h2>{{ .nombre }}</h2>
                    
                    {{/* Solo mostramos etiquetas si variantes no es null */}}
                    {{ if $variantes }}
                        {{ range $variantes }}
                            <span class="header-variant-label">{{ . }}</span>
                        {{ end }}
                    {{ end }}
                </summary>
                <div class="category-content">
                  {{/* --- LISTA DE PRODUCTOS --- */}}
                  <ul class="products">
                      {{ range sort .productos "orden" }}
                      
                      {{ if $variantes }}
                          {{/* CASO 1: CON VARIANTES (PIZZAS) */}}
                          <li class="product grid-layout" style="{{ $gridStyle | safeCSS }}">
                              <div class="text">
                                  <span class="name">{{ .nombre }}</span>
                                  {{ with .descripcion }}<p class="desc">{{ . }}</p>{{ end }}
                              </div>
                              
                              {{ $prod := . }}
                              {{ range $v := $variantes }}
                                  {{/* Acceso seguro al mapa de precios */}}
                                  {{ $p := index $prod.precio $v }}
                                  <span class="variant-price">
                                      {{ if $p }} ${{ $p }} {{ else }} - {{ end }}
                                  </span>
                              {{ end }}
                          </li>

                      {{ else }}
                          {{/* CASO 2: SIN VARIANTES (EMPANADAS - PRECIO ÚNICO) */}}
                          <li class="product single-price">
                              <div class="text">
                                  <span class="name">{{ .nombre }}</span>
                                  {{ with .descripcion }}<p class="desc">{{ . }}</p>{{ end }}
                              </div>
                              <span class="price">${{ .precio }}</span>
                          </li>
                      {{ end }}

                      {{ else }}
                          <li class="product">No hay productos</li>
                      {{ end }}
                  </ul>
                </div>
            </details>
            {{ end }}
        </main>
    </div>
    

    <footer>
        <p>&copy; {{ now.Format "2006" }} {{ $menu.restaurantInfo.nombre }} — Villa Gesell, Argentina</p>
    </footer>
</body>
</html>